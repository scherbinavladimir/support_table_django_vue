(function(){"use strict";var e={5492:function(e,t,a){var n=a(9242),i=a(3396),l=a(7139);function s(e){return"string"===typeof e&&e.match(/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/)}const o=e=>((0,i.dD)("data-v-2008e07a"),e=e(),(0,i.Cn)(),e),r={class:"w-100 h-100"},c={class:"table-wrap w-100 h-100 overflow-x-scroll"},u={class:"position-relative"},p={class:"position-sticky top-0"},d=o((()=>(0,i._)("th",null,[(0,i._)("input",{type:"checkbox",disabled:""})],-1))),g=["onClick"],v={class:"d-flex justify-content-between"},f={key:0,class:"ms-3 flex-shrink-0 d-flex align-items-center"},m=["src"],_={class:"overflow-y-scroll"},w=o((()=>(0,i._)("td",null,[(0,i._)("input",{type:"checkbox"})],-1))),h=["innerHTML"],b={class:"mt-2"},y={class:"mx-auto d-flex justify-content-between pagination-bar"},k={key:0,class:"d-flex"},x=["onClick"],D={key:1,class:"d-flex"},S=o((()=>(0,i._)("span",null,"1",-1))),C=[S],P={key:1},q=["onClick"],H={key:2};var O={__name:"TableVue",props:{columns:{type:Object,required:!0},rows:{type:Array,required:!0,default:()=>[]},pagination:{type:Object,default:()=>({page:1,pageSize:10,maxPage:null})}},emits:["sort","paginate"],setup(e,{emit:t}){const n=e,o=e=>{if(!e.sort)return;const a=!(void 0===e.sort.desc||!0===e.sort.desc);t("sort",e,a)},S=e=>s(e)?new Date(e).toLocaleString():"boolean"===typeof e?`<i class="bi bi${e?"-check":""}-circle"></i>`:e,O=e=>e.sort?e.sort.active&&e.sort.desc?"order-desc":e.sort.active&&!1===e.sort.desc?"order-asc":"opacity-25":"",j=e=>{e<1?e=1:e>n.pagination.maxPage&&(e=n.pagination.maxPage),t("paginate",e)},Z=(0,i.Fl)((()=>n.pagination.page>2&&n.pagination.page+1<n.pagination.maxPage?[n.pagination.page-1,n.pagination.page,n.pagination.page+1]:n.pagination.page>2&&n.pagination.page+1===n.pagination.maxPage?[n.pagination.page-2,n.pagination.page-1,n.pagination.page]:[1,2,3])),I=(0,i.Fl)((()=>n.columns.filter((e=>"id"!==e.key&&e.selected))));return(t,n)=>((0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",c,[(0,i._)("table",u,[(0,i._)("thead",p,[(0,i._)("tr",null,[d,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(I.value,(e=>((0,i.wg)(),(0,i.iD)("th",{onClick:t=>o(e)},[(0,i._)("div",v,[(0,i._)("div",null,(0,l.zw)(e.name),1),e.sort?((0,i.wg)(),(0,i.iD)("div",f,[(0,i._)("img",{height:"8",width:"8",class:(0,l.C_)(O(e)),src:a(725)},null,10,m)])):(0,i.kq)("",!0)])],8,g)))),256))])]),(0,i._)("tbody",_,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.rows,(e=>((0,i.wg)(),(0,i.iD)("tr",null,[w,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(I.value,(t=>((0,i.wg)(),(0,i.iD)("td",{innerHTML:S(e[t.key]),class:"cell text-nowrap"},null,8,h)))),256))])))),256))])])]),(0,i._)("div",b,[(0,i._)("div",y,[(0,i._)("div",null,[(0,i._)("i",{onClick:n[0]||(n[0]=t=>j(e.pagination.page-1)),class:"bi bi-chevron-left fs-14 fw-bold"})]),e.pagination.maxPage&&e.pagination.maxPage<5?((0,i.wg)(),(0,i.iD)("div",k,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Array.from({length:e.pagination.maxPage},((e,t)=>t+1)),(t=>((0,i.wg)(),(0,i.iD)("div",{class:(0,l.C_)(["page mx-1 text-center",{active:t===e.pagination.page}]),onClick:e=>j(t)},[(0,i._)("span",null,(0,l.zw)(t),1)],10,x)))),256))])):(0,i.kq)("",!0),e.pagination.maxPage&&e.pagination.maxPage>=5?((0,i.wg)(),(0,i.iD)("div",D,[Z.value[0]>1?((0,i.wg)(),(0,i.iD)("div",{key:0,onClick:n[1]||(n[1]=e=>j(1)),class:(0,l.C_)(["page mx-1 text-center",{active:1===e.pagination.page}])},C,2)):(0,i.kq)("",!0),Z.value[0]>2?((0,i.wg)(),(0,i.iD)("span",P,"...")):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(Z.value,(t=>((0,i.wg)(),(0,i.iD)("div",{onClick:e=>j(t),class:(0,l.C_)(["page mx-1 text-center",{active:t===e.pagination.page}])},[(0,i._)("span",null,(0,l.zw)(t),1)],10,q)))),256)),Z.value[Z.value.length-1]+1<e.pagination.maxPage?((0,i.wg)(),(0,i.iD)("span",H,"...")):(0,i.kq)("",!0),(0,i._)("div",{onClick:n[2]||(n[2]=t=>j(e.pagination.maxPage)),class:(0,l.C_)([{active:e.pagination.maxPage===e.pagination.page},"page mx-1 text-center"])},[(0,i._)("span",null,(0,l.zw)(e.pagination.maxPage),1)],2)])):(0,i.kq)("",!0),(0,i._)("div",null,[(0,i._)("i",{onClick:n[3]||(n[3]=t=>j(e.pagination.page+1)),class:"bi bi-chevron-right fs-14 fw-bold"})])])])]))}},j=a(89);const Z=(0,j.Z)(O,[["__scopeId","data-v-2008e07a"]]);var I=Z,z=a(4870),T=a(4161),V=a(4677);const F=(0,V.pm)();class Y{constructor(e=""){this.BASE_URL=e}_request(e){return e.method||(e.method="get"),e.baseURL=this.BASE_URL,new Promise(((t,a)=>{(0,T.Z)(e).then((e=>t(e.data))).catch((e=>{let t=null;e.response&&e.response.data.detail&&(t=e.response.data.detail),t||(t=e.toString()),F.error(t),a(e)}))}))}getSupportRequests(e){return this._request({url:"/support_request",params:e})}getSupportRequestFields(){return this._request({url:"/support_request/fields"})}}const U=new Y("/api"),A={class:"d-flex statusFilter overflow-x-scroll"},E=["onClick"];var K={__name:"StatusFilter",props:{statuses:{type:Array,required:!0}},emits:["filter"],setup(e,{emit:t}){const a=e=>{t("filter",e.value)};return(t,n)=>((0,i.wg)(),(0,i.iD)("div",A,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.statuses,(e=>((0,i.wg)(),(0,i.iD)("div",{onClick:t=>a(e),class:(0,l.C_)(["text-nowrap fs-14",{active:e.active}])},[(0,i._)("span",null,(0,l.zw)(e.title),1)],10,E)))),256))]))}};const M=(0,j.Z)(K,[["__scopeId","data-v-fb1d4184"]]);var R=M,L=a(8579);const W=e=>((0,i.dD)("data-v-b5310b26"),e=e(),(0,i.Cn)(),e),B={class:"position-relative"},$={key:0,class:"searchPopup"},J=["value"],N=W((()=>(0,i._)("i",{class:"bi bi-search"},null,-1))),G=[N];var Q={__name:"SearchInput",props:{modelValue:{type:String}},emits:["update:modelValue"],setup(e,{emit:t}){const a=(0,z.iH)(!1),n=(0,z.iH)(null);return(0,i.m0)((()=>{a&&n.value&&(0,i.Y3)((()=>n.value.focus()))})),(l,s)=>(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",B,[(0,i._)("div",{onClick:s[0]||(s[0]=e=>a.value=!a.value),class:"searchBtn text-nowrap fs-14"},[(0,i._)("span",null,[(0,i.WI)(l.$slots,"default")])]),a.value?((0,i.wg)(),(0,i.iD)("div",$,[(0,i._)("input",{ref_key:"searchInput",ref:n,type:"text",value:e.modelValue,onInput:s[1]||(s[1]=e=>t("update:modelValue",e.target.value))},null,40,J),(0,i._)("div",{onClick:s[2]||(s[2]=e=>a.value=!1)},G)])):(0,i.kq)("",!0)])),[[(0,z.SU)(L.Z),()=>a.value=!1]])}};const X=(0,j.Z)(Q,[["__scopeId","data-v-b5310b26"]]);var ee=X;const te=e=>((0,i.dD)("data-v-4e0f2e97"),e=e(),(0,i.Cn)(),e),ae={class:"position-relative"},ne=te((()=>(0,i._)("i",{class:"bi bi-funnel"},null,-1))),ie=[ne],le={key:0,class:"selectPopup"},se={class:"my-2"},oe={class:"ms-2"},re=["checked","onInput"];var ce={__name:"FieldSelector",props:{fields:{type:Array}},emits:["select"],setup(e,{emit:t}){const a=(0,z.iH)(!1);return(n,s)=>(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",ae,[(0,i._)("div",{onClick:s[0]||(s[0]=e=>a.value=!a.value),class:"selectBtn fs-14"},ie),a.value?((0,i.wg)(),(0,i.iD)("div",le,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.fields.filter((e=>"id"!==e.key)),(e=>((0,i.wg)(),(0,i.iD)("div",se,[(0,i._)("label",oe,[(0,i._)("input",{type:"checkbox",checked:e.selected,onInput:a=>t("select",e.key,a.target.checked)},null,40,re),(0,i.Uk)(" "+(0,l.zw)(e.name),1)])])))),256))])):(0,i.kq)("",!0)])),[[(0,z.SU)(L.Z),()=>a.value=!1]])}};const ue=(0,j.Z)(ce,[["__scopeId","data-v-4e0f2e97"]]);var pe=ue;const de={class:"mt-5 d-flex flex-lg-row flex-column align-items-center justify-content-center my-3 opacity-75 fs-14"},ge=(0,i.uE)('<div class="fst-italic mb-lg-0 mb-2">© Vladimir Shcherbina, 2023</div><div class="ms-lg-2"><a class="text-dark ms-2" target="_blank" href="https://t.me/+79882530660"><i class="bi bi-telegram"></i></a> <a class="text-dark ms-2" href="mailto:vvschrus@gmail.com">vvschrus@gmail.com</a></div>',2),ve=[ge];function fe(e,t){return(0,i.wg)(),(0,i.iD)("div",de,ve)}const me={},_e=(0,j.Z)(me,[["render",fe]]);var we=_e;const he={class:"container mt-4"},be=(0,i._)("h3",{class:"fs-3 mb-3"}," Список обращений",-1),ye={class:"d-lg-flex justify-content-between mb-2"},ke={class:"d-flex align-items-center mt-2 mt-lg-0"};var xe={__name:"App",setup(e){const t=(0,z.iH)({count:0,results:[]}),a=(0,z.iH)({page:1,pageSize:20});let n={page:a.value.page,page_size:a.value.pageSize},l=!1;const s=async()=>{l||(l=!0,t.value=await U.getSupportRequests(n),a.value.maxPage=Math.round(t.value.count/a.value.pageSize),a.value.page=n.page,l=!1)};let o=[];const r=(0,z.iH)([]),c=async()=>{o=await U.getSupportRequestFields(),r.value=Object.keys(o).map((e=>({key:e,name:o[e].name,sort:o[e].ordering?{active:!1}:null,selected:!0})))},u=(e,t)=>{r.value.filter((t=>t.key===e))[0].selected=t,(0,i.Y3)((()=>localStorage.setItem("selectedColumns",JSON.stringify(r.value))))};(0,i.bv)((()=>{s(),c().then((()=>{const e=JSON.parse(localStorage.getItem("selectedColumns",null));e&&e.forEach((e=>{u(e.key,e.selected)}))}))}));const p=(e,t)=>{n.page=1,r.value.forEach((a=>{a===e?(a.sort.active=!0,a.sort.desc=t):a.sort&&(delete a.sort.desc,a.sort.active=!1)})),n.ordering=`${t?"-":""}${e.key}`,s()},d=e=>{n.page!==e&&(n.page=e,s())},g=(0,z.iH)([{value:"new",title:"Открытые"},{value:"proc",title:"Ожидают подтверждения"},{value:"rjct",title:"Неоценённые"},{value:"clsd",title:"Закрытые"},{value:void 0,title:"Все",active:!0}]),v=e=>{n.page=1,g.value.forEach((e=>delete e.active)),g.value.filter((t=>t.value===e))[0].active=!0,n.status=e,s()},f=(0,z.iH)("");return(0,i.m0)((()=>{n.page=1,f.value?n.search=f.value:n.search=void 0,s()})),(e,n)=>((0,i.wg)(),(0,i.iD)("div",he,[be,(0,i._)("div",ye,[(0,i.Wm)(R,{statuses:g.value,onFilter:v},null,8,["statuses"]),(0,i._)("div",ke,[(0,i.Wm)(ee,{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=e=>f.value=e)},{default:(0,i.w5)((()=>[(0,i.Uk)("Глобальный поиск")])),_:1},8,["modelValue"]),(0,i.Wm)(pe,{fields:r.value,onSelect:u,class:"ms-2"},null,8,["fields"])])]),(0,i.Wm)(I,{columns:r.value,rows:t.value.results,pagination:a.value,class:"tableMaxHeight",onSort:p,onPaginate:d},null,8,["columns","rows","pagination"]),(0,i.Wm)(we,{class:"pt-2"})]))}};const De=xe;var Se=De,Ce=a(393);a(4260),a(2166);const Pe=(0,n.ri)(Se);Pe.component("VueDatePicker",Ce.Z),Pe.use(V.ZP,{}),Pe.mount("#app")},725:function(e,t,a){e.exports=a.p+"static/img/triangle.b0a57161.svg"}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var l=t[n]={exports:{}};return e[n].call(l.exports,l,l.exports,a),l.exports}a.m=e,function(){var e=[];a.O=function(t,n,i,l){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],i=e[u][1],l=e[u][2];for(var o=!0,r=0;r<n.length;r++)(!1&l||s>=l)&&Object.keys(a.O).every((function(e){return a.O[e](n[r])}))?n.splice(r--,1):(o=!1,l<s&&(s=l));if(o){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[n,i,l]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,l,s=n[0],o=n[1],r=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(r)var u=r(a)}for(t&&t(n);c<s.length;c++)l=s[c],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(u)},n=self["webpackChunkfe"]=self["webpackChunkfe"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(5492)}));n=a.O(n)})();
//# sourceMappingURL=app.b376dc9f.js.map